{"version":3,"sources":["pages/auth/CompleteRegister.js"],"names":["CompleteRegister","_ref","history","_useState","useState","_useState2","Object","C_Users_dharv_OneDrive_Desktop_mernconnection_EcommProject_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","email","setEmail","_useState3","_useState4","password","setPassword","dispatch","useDispatch","navigate","useNavigate","useEffect","window","localStorage","getItem","sumbmitHandler","_ref2","C_Users_dharv_OneDrive_Desktop_mernconnection_EcommProject_client_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_asyncToGenerator__WEBPACK_IMPORTED_MODULE_0__","_regeneratorRuntime","mark","_callee","e","user","idToken","wrap","_context","prev","next","preventDefault","toast","error","abrupt","length","auth","signInWithEmailLink","location","href","sent","emailVerified","removeItem","currentUser","updatePassword","getIdTokenResult","console","log","createOrUpdateUser","token","then","res","type","payload","name","data","role","_id","catch","err","t0","message","stop","_x","apply","this","arguments","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","className","onSubmit","value","disabled","placeholder","onChange","target","autoFocus"],"mappings":"w8MAgHeA,UAtGf,SAAAC,GAAuCA,EAAXC,QAAW,IAAAC,EACXC,qBADWC,EAAAC,OAAAC,EAAA,EAAAD,CAAAH,EAAA,GAC9BK,EAD8BH,EAAA,GACvBI,EADuBJ,EAAA,GAAAK,EAELN,qBAFKO,EAAAL,OAAAC,EAAA,EAAAD,CAAAI,EAAA,GAE9BE,EAF8BD,EAAA,GAEpBE,EAFoBF,EAAA,GAI/BG,EAAWC,cACXC,EAAWC,cAIjBC,oBAAU,WACRT,EAASU,OAAOC,aAAaC,QAAQ,0BACpC,IAEH,IAAMC,EAAc,eAAAC,EAAAjB,OAAAkB,EAAA,EAAAlB,CAAAmB,IAAAC,KAAG,SAAAC,EAAOC,GAAP,IAAAC,EAAAC,EAAA,OAAAL,IAAAM,KAAA,SAAAC,GAAA,cAAAA,EAAAC,KAAAD,EAAAE,MAAA,UACrBN,EAAEO,iBAEG3B,GAAUI,EAHM,CAAAoB,EAAAE,KAAA,eAInBE,IAAMC,MAAM,oCAJOL,EAAAM,OAAA,sBAQjB1B,EAAS2B,OAAS,GARD,CAAAP,EAAAE,KAAA,eASnBE,IAAMC,MAAM,gDATOL,EAAAM,OAAA,wBAAAN,EAAAC,KAAA,EAAAD,EAAAE,KAAA,GAcEM,IAAKC,oBACxBjC,EACAW,OAAOuB,SAASC,MAhBC,YAAAX,EAAAY,KAmBRf,KAAKgB,cAnBG,CAAAb,EAAAE,KAAA,gBAqBjBf,OAAOC,aAAa0B,WAAW,wBAGzBjB,EAAOW,IAAKO,YAxBDf,EAAAE,KAAA,GAyBXL,EAAKmB,eAAepC,GAzBT,eAAAoB,EAAAE,KAAA,GA0BKL,EAAKoB,mBA1BV,QA0BXnB,EA1BWE,EAAAY,KA6BjBM,QAAQC,IAAItB,GAEZuB,YAAmBtB,EAAQuB,OACxBC,KAAK,SAACC,GACLzC,EAAS,CACP0C,KAAM,YACNC,QAAS,CACPC,KAAMH,EAAII,KAAKD,KACflD,MAAO+C,EAAII,KAAKnD,MAChB6C,MAAOvB,EAAQuB,MACfO,KAAML,EAAII,KAAKC,KACfC,IAAKN,EAAII,KAAKE,SAInBC,MAAM,SAACC,GAAD,OAASb,QAAQC,IAAIY,KAE9B/C,EAAS,KA9CQ,QAAAgB,EAAAE,KAAA,iBAAAF,EAAAC,KAAA,GAAAD,EAAAgC,GAAAhC,EAAA,SAiDnBI,IAAMC,MAAML,EAAAgC,GAAMC,SAjDC,yBAAAjC,EAAAkC,SAAAvC,EAAA,kBAAH,gBAAAwC,GAAA,OAAA5C,EAAA6C,MAAAC,KAAAC,YAAA,GA4EpB,OACEC,EAAAC,EAAAC,cAAA,OAAKC,UAAU,gCACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,OACbH,EAAAC,EAAAC,cAAA,OAAKC,UAAU,wBACbH,EAAAC,EAAAC,cAAA,MAAIC,UAAU,MAAd,0BA1BNH,EAAAC,EAAAC,cAAA,QAAME,SAAUrD,GACdiD,EAAAC,EAAAC,cAAA,OAAKC,UAAU,cACbH,EAAAC,EAAAC,cAAA,SAAOjB,KAAK,QAAQkB,UAAU,eAAeE,MAAOpE,EAAOqE,UAAQ,KAGrEN,EAAAC,EAAAC,cAAA,OAAKC,UAAU,cACbH,EAAAC,EAAAC,cAAA,SACEjB,KAAK,WACLkB,UAAU,eACVE,MAAOhE,EACPkE,YAAY,WACZC,SAAU,SAACnD,GAAD,OAAOf,EAAYe,EAAEoD,OAAOJ,QACtCK,WAAS,KAIbV,EAAAC,EAAAC,cAAA,UAAQjB,KAAK,SAASkB,UAAU,6BAAhC","file":"static/js/8.87133d63.chunk.js","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { useNavigate } from \"react-router-dom\";\r\n\r\nimport { auth } from \"../../firebase\";\r\nimport { toast } from \"react-toastify\";\r\nimport \"react-toastify/dist/ReactToastify.css\";\r\n\r\nimport { createOrUpdateUser } from \"../../functions/auth\";\r\n\r\nfunction CompleteRegister({ history }) {\r\n  const [email, setEmail] = useState();\r\n  const [password, setPassword] = useState();\r\n\r\n  const dispatch = useDispatch();\r\n  const navigate = useNavigate();\r\n\r\n  // const { user } = useSelector((state) => ({ ...state }));\r\n\r\n  useEffect(() => {\r\n    setEmail(window.localStorage.getItem(\"emailForRegistration\"));\r\n  }, []);\r\n\r\n  const sumbmitHandler = async (e) => {\r\n    e.preventDefault();\r\n\r\n    if (!email || !password) {\r\n      toast.error(\"Email ans password is required!!\");\r\n      return;\r\n    }\r\n\r\n    if (password.length < 6) {\r\n      toast.error(\"password must be at least 6 character long! \");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const result = await auth.signInWithEmailLink(\r\n        email,\r\n        window.location.href\r\n      );\r\n\r\n      if (result.user.emailVerified) {\r\n        //remove email from localstorage\r\n        window.localStorage.removeItem(\"emailForRegistration\");\r\n\r\n        //get user id token\r\n        const user = auth.currentUser;\r\n        await user.updatePassword(password);\r\n        const idToken = await user.getIdTokenResult();\r\n\r\n        //redux\r\n        console.log(user);\r\n\r\n        createOrUpdateUser(idToken.token)\r\n          .then((res) => {\r\n            dispatch({\r\n              type: \"LOGGED_IN\",\r\n              payload: {\r\n                name: res.data.name,\r\n                email: res.data.email,\r\n                token: idToken.token,\r\n                role: res.data.role,\r\n                _id: res.data._id,\r\n              },\r\n            });\r\n          })\r\n          .catch((err) => console.log(err));\r\n\r\n        navigate(\"/\");\r\n      }\r\n    } catch (error) {\r\n      toast.error(error.message);\r\n    }\r\n  };\r\n\r\n  const completeRegisterForm = () => (\r\n    <form onSubmit={sumbmitHandler}>\r\n      <div className=\"form-group\">\r\n        <input type=\"email\" className=\"form-control\" value={email} disabled />\r\n      </div>\r\n\r\n      <div className=\"form-group\">\r\n        <input\r\n          type=\"password\"\r\n          className=\"form-control\"\r\n          value={password}\r\n          placeholder=\"password\"\r\n          onChange={(e) => setPassword(e.target.value)}\r\n          autoFocus\r\n        />\r\n      </div>\r\n\r\n      <button type=\"submit\" className=\"btn btn-outline-secondary\">\r\n        Register Complete\r\n      </button>\r\n    </form>\r\n  );\r\n\r\n  return (\r\n    <div className=\"container p-5  mt-5 relative\">\r\n      <div className=\"row\">\r\n        <div className=\"col-md-6 offset-md-3\">\r\n          <h2 className=\"h2\" >Complete Registeration</h2>\r\n          {/* <ToastContainer/> */}\r\n          {completeRegisterForm()}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default CompleteRegister;\r\n"],"sourceRoot":""}